var UtilJS={},_cf,MasterPageController,fileAttachUpload,lazyLoadMore,customSelect2,dateTimePicker,formatMoney,getWidth,getHeight,lazyLoad,noInput,whenEnter,compile,paginationStyle1,paginationStyle2,inputFormat,$localstorage,CommonFactory,ApiHelper,UtilFactory,HelperFactory,DataFactory,dateFormat,trustHtml,ifEmpty,toFixedDecimal,lstDependency,MyApp,addFactory,addController,addDirective,addFilter;UtilJS.Files={};UtilJS.Table={};UtilJS.Cookie={};UtilJS.Loading={};UtilJS.ShowMenuRight=function(){$("body").addClass("openmenuright")};UtilJS.HideMenuRight=function(){$("body").removeClass("openmenuright")};UtilJS.Loading.Show=function(){UtilJS.Loading.IsLoading=!0;$("#cover-spin").removeClass("hide")};UtilJS.Loading.Hide=function(n){UtilJS.Loading.IsLoading=!1;n?setTimeout(function(){$("#cover-spin").addClass("hide")},n):$("#cover-spin").addClass("hide")};UtilJS.Loading.ShowProgress=function(n){progressJs().start();progressJs().set(5);n.i=5;n.interval=setInterval(()=>{!0&&(n.i+=5,n.i>=90&&clearInterval(n.interval),progressJs().increase(5))},500)};UtilJS.Loading.HideProgress=function(){progressJs().end()};UtilJS.Table.InitScrollTable=function(n){n="#"+n;var t=n+" .divFooter";$(document).ready(function(){$(t).scroll(function(){$(n+" .divHeader").scrollLeft($(t).scrollLeft());$(n+" .grid_header th.anchor").css("left",$(t).scrollLeft());$(n+" .divBody").scrollLeft($(t).scrollLeft());$(n+" .grid_body td.anchor").css("left",$(t).scrollLeft());$(n+" .grid_footer th.anchor").css("left",$(t).scrollLeft())})})};UtilJS.Table.UpdateBodyTable=function(n,t){$(n+".scroll-table tbody").css("height",t)};UtilJS.Table.ResetScrollLeft=function(){setTimeout(function(){$(".divFooter").scrollLeft(0)},0)};UtilJS.ParseQueryString=function(n){var u={},i,r,t,f;for(i=n.split("&"),t=0,f=i.length;t<f;t++)r=i[t].split("="),u[r[0]]=r[1];return u};UtilJS.Cookie.Create=function(n,t,i){var r,u;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"};UtilJS.Cookie.Remove=function(n){UtilJS.Cookie.Create(n,"",-1)};UtilJS.Files.Download=function(n){var t={url:"",method:"POST",data:{},success:undefined,ContentType:"application/x-www-form-urlencoded; charset=UTF-8",ResponseType:"blob",callback:undefined,beforsend:undefined,display:undefined},i,r;$.extend(t,n);i=!1;try{r=new Blob(["test text"],{type:"text/plain"});i=r instanceof Blob}catch(u){}i?UtilJS.Files.DownloadWithXHR(t):UtilJS.Files.DownLoadWithIFrame(t)};UtilJS.Files.DownloadWithXHR=function(n){var t,i,u,r;n.beforsend!=undefined&&n.beforsend();t=new XMLHttpRequest;t.onload=function(){var u,f,e,i,r;if(t.status===200){if(u=t.response,u.type=="application/json"){f=new FileReader;f.onloadend=function(){try{var t=JSON.parse(f.result);n.callback!=undefined&&n.callback(t);n.success!=undefined&&n.success(t)}catch(i){n.callback!=undefined&&n.callback();n.success!=undefined&&n.success()}};f.readAsText(u);return}if(e=this.getResponseHeader("FileName"),e==null||e==undefined){jAlert.Warning("Không thể tải file");n.callback!=undefined&&n.callback();n.success!=undefined&&n.success();return}i=document.createElement("a");r=window.URL.createObjectURL(u);n.display=="blob"?window.open(r,"_blank"):(i.href=r,i.download=e,document.body.appendChild(i),i.click(),navigator.userAgent.toLowerCase().indexOf("firefox")>-1?setTimeout(function(){document.body.removeChild(i);window.URL.revokeObjectURL(r)},1e3):(document.body.removeChild(i),window.URL.revokeObjectURL(r)));n.callback!=undefined&&n.callback();n.success!=undefined&&n.success();return}};t.onreadystatechange=function(){if(t.readyState===4&&t.status!==200){switch(t.status){case 400:strMessage="Lỗi dữ liệu không hợp lệ";break;case 401:strMessage="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:strMessage="Bạn không có quyền thực hiện thao tác này.";break;case 404:strMessage="URL action không chính xác";break;case 405:strMessage="Phương thức không được chấp nhận";break;case 500:strMessage="Lỗi hệ thống";break;case 502:strMessage="Đường truyền kém";break;case 503:strMessage="Dịch vụ không hợp lệ";break;case 504:strMessage="Hết thời gian chờ";break;case 440:strMessage="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:strMessage="Lỗi chưa xác định"}t.status==401||t.status==440||t.status==0?UtilJS.ConfirmRedirectLogin():jAlert.Warning(strMessage);n.callback!=undefined&&n.callback();n.success!=undefined&&n.success()}};t.open(n.method,n.url);t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.responseType=n.ResponseType;try{if(n.method=="POST"){for(t.setRequestHeader("Content-Type",n.ContentType),i=[],u="",UtilJS.Files.SetFromData(i,n.data),r=0;r<i.length;r++)u+=i[r].name+"="+i[r].data+"&";t.setRequestHeader("Accept","application/json; charset=utf-8");t.send(u)}else t.send()}catch(f){}};UtilJS.Files.DownLoadWithIFrame=function(n){var r=$('<form id="frameExport" action="'+n.url+'" method="'+n.method+'" target="frameExport"><\/form>'),i=[],u="",t;for(UtilJS.Files.SetFromData(i,n.data),t=0;t<i.length;t++)u+='<input name="'+i[t].name+'" value="'+i[t].data+'">';$(r).append(u);$("#frameExport").length==0&&$("body").append('<iframe id="frameExport" name="frameExport" style="display:none" onload="UtilJS.Files.IframeOnLoad();"><\/iframe>');$(r).appendTo("body").submit().remove()};UtilJS.Files.IframeOnLoad=function(){var t=document.getElementById("frameExport"),i=t.contentDocument.body.innerHTML,n=$(i).text();if(n!=undefined&&n!=""&&(n=JSON.parse(n),n.objCodeStep.Status!=jAlert.Status.Success)){jAlert.Notify(n.objCodeStep);return}};UtilJS.Files.SetFromData=function(n,t,i){var u,r;if(typeof t=="object")for(u=Object.keys(t),r=0;r<u.length;r++)t[u[r]]!=null&&(i==""||i==undefined?UtilJS.Files.SetFromData(n,t[u[r]],u[r]):UtilJS.Files.SetFromData(n,t[u[r]],i+"["+u[r]+"]"));else n.push({name:i,data:t})};UtilJS.ConfirmRedirectLogin=function(n){UtilJS.IsShowConfirmRedirectLogin||(UtilJS.IsShowConfirmRedirectLogin=!0,$.confirm({title:"Thông báo!",content:"Phiên đăng nhập hết hạn, vui lòng bấm đồng ý để tải lại trang",buttons:{formSubmit:{text:'<i class="fa fa-check-circle"><\/i> Đồng ý',btnClass:"btn cc-btn-style cc-btn-color-blue",action:function(){UtilJS.Cookie.Remove("returnUrl");UtilJS.Cookie.Create("returnUrl",window.location.href,30);UtilJS.IsShowConfirmRedirectLogin=!1;n&&n.IsRedirectLogin?window.location.href="/Accounts/Login":location.reload()}},formSubmit2:{text:"Hủy",btnClass:"btn cc-btn-style",action:function(){UtilJS.IsShowConfirmRedirectLogin=!1}}}}))};UtilJS.guid=function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()};window.onerror=function(n,t,i,r,u){var f={type:"error",data:n,stack:u.stack,url:window.location.href};$.ajax({url:"/ClientLogs/consolescript",type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(f),success:function(){}})};UtilJS.openReLogin=function(){var n,r=typeof window.screenX!="undefined"?window.screenX:window.screenLeft,u=typeof window.screenY!="undefined"?window.screenY:window.screenTop,f=typeof window.outerWidth!="undefined"?window.outerWidth:document.body.clientWidth,e=typeof window.outerHeight!="undefined"?window.outerHeight:document.body.clientHeight-22,t=500,i=450,o=parseInt(r+(f-t)/2,10),s=parseInt(u+(e-i)/2.5,10),h="width="+t+",height="+i+",left="+o+",top="+s;return n=window.open("/Accounts/ReLogin","Refresh login",h),window.focus&&n.focus(),!1};window.ReLoginCallback=function(n,t){if(n){jconfirm.instances[0]!=undefined&&jconfirm.instances[0].close();jAlert.Success("Đăng nhập lại thành công");var i=JSON.parse(localStorage.getItem("UserPricinpal"));t!=i.Username&&$.confirm({title:"Thông báo!",content:"Bạn đã đăng nhập tài khoản khác, vui lòng bấm đồng ý để tải lại trang",buttons:{formSubmit:{text:'<i class="fa fa-check-circle"><\/i> Đồng ý',btnClass:"btn cc-btn-style cc-btn-color-blue",action:function(){location.reload()}}}});UtilJS.Relogin!=undefined&&UtilJS.Relogin.Action!=undefined&&(UtilJS.Relogin.Action(),UtilJS.Relogin.scope.$apply());UtilJS.Relogin={}}else jAlert.Warning("Không thể đăng nhập")};UtilJS.reValidForm=function(n){var t=$("#"+n).removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t);customValidate.SetForm(n,"")};UtilJS.Tree={};UtilJS.Tree.CheckParentIDNotExists=function(n){n.forEach(t=>{if(t.parent!="#"){let i=_.find(n,n=>n.parent==t.id);i==undefined}})};_cf=function(){function n(n){var t=n.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}return function(){return Array.prototype.reduce.call(arguments,function(t,i){return t===undefined||i===undefined?undefined:Math.max(t,n(i))},-Infinity)}}();Math.add=function(){function t(t,i){return Math.round(t)+n*i}var n=_cf.apply(null,arguments);return n===undefined?undefined:Array.prototype.reduce.call(arguments,t,0)/n};Math.subtraction=function(n,t){var i=_cf(n,t);return(n*i-t*i)/i};Math.multiplication=function(){function t(t,i){return Math.round(t*n)*Math.round(i*n)/(n*n)}var n=_cf.apply(null,arguments);return Array.prototype.reduce.call(arguments,t,1)};Math.division=function(n,t){var i=_cf(n,t);return n*i/(t*i)};UtilJS.precise_round=function(n,t){if(typeof n!="number"||typeof t!="number")return!1;var i=n>=0?1:-1;return(Math.round(n*Math.pow(10,t)+i*.0001)/Math.pow(10,t)).toFixed(t)};UtilJS.toFixedDecimal=function(n,t){var i,r;if(!n)return 0;if(i=n.toString().split(".")[1],i){if(t==undefined||t==="")t=i.length;else{for(i=i.toString().slice(0,t),r=i.length;r>0;r--)if(i.charAt(r-1)!=0)break;else i=i.substring(0,i.length-1);t=i.length}return Number(UtilJS.precise_round(parseFloat(n),t))}return n};UtilJS.DateTime={};UtilJS.DateTime.IsValid=function(n){return n?Date.parse(n)<0?!1:moment(n).isValid():!1};UtilJS.DateTime.ToString=function(n,t){var f,i;if(!n)return"underfine";var r=new Date(parseInt(n.replace(/(^.*\()|([+-].*$)/g,""))),e=r.getDate(),u=e.toString();return(e<=9&&(u="0"+u),f=r.getMonth()+1,i=f.toString(),f<=9&&(i="0"+i),t=="dd/mm/yyyy")?u+"/"+i+"/"+r.getFullYear():u+"-"+i+"-"+r.getFullYear()};UtilJS.String={};UtilJS.String.IsNullOrEmpty=function(n){return!n||n==null?!0:!1};UtilJS.String.RemoveUnicode=function(n){return n=n.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a"),n=n.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e"),n=n.replace(/ì|í|ị|ỉ|ĩ/g,"i"),n=n.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o"),n=n.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u"),n=n.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y"),n.replace(/đ/g,"d")};UtilJS.String.IsContain=function(n,t,i){return UtilJS.String.IsNullOrEmpty(n)?!1:UtilJS.String.IsNullOrEmpty(t)?!0:(n=n.normalize(),t=t.normalize(),n=n.toLowerCase(),t=t.toLowerCase(),i&&(n=UtilJS.String.RemoveUnicode(n),t=UtilJS.String.RemoveUnicode(t)),n.indexOf(t)<0)?!1:!0};UtilJS.String.IsContainUnsigned=function(n){return UtilJS.String.IsNullOrEmpty(n)?!1:(n=n.normalize(),n=n.toLowerCase(),n=UtilJS.String.RemoveUnicode(n),/^[a-zA-Z0-9- ]*$/.test(n)==!1)?!0:!1};UtilJS.isNumber=function(n){var t=n.which?n.which:n.keyCode;return t!=46&&t>31&&(t<48||t>57)?!1:!0};UtilJS.checkStringIsNumber=function(n){return/^[-]?\d+$/.test(n)};UtilJS.SumDecimal=function(n){return Math.round(n*1e12)/1e12};UtilJS.round500=function(n){if(n<=0)return n;var t=n%1e3;return t==500?n:t>500?n-t+1e3:n-t};UtilJS.Array={};UtilJS.Array.Sort=function(n,t){return _.sortBy(n,function(n){try{if(!n[t])return"";let i=n[t].normalize();return i=i.toLowerCase(),UtilJS.String.RemoveUnicode(i)}catch(i){throw i;}})};UtilJS.Array.Picks=function(n,t,i){let r=[];return n.forEach(n=>{let u={};t.forEach(t=>{u[t]=n[t]});i?r.push(u):r.push(_.clone(u))}),r};UtilJS.Array.IsDuplicate=function(n,t){let r=[];for(var i=0;i<n.length;i++){let u=n[i],f=_.find(r,n=>n==u[t]);if(f!=undefined)return!0;r.push(u[t])}return!1};UtilJS.Array.Count=function(n,t){let i=0;return n.forEach(n=>{t(n)&&(i+=1)}),i};UtilJS.Array.Sum=function(n,t,i){let r=0;return i?n.forEach(n=>{i(n)&&(r=Math.add(r,n[t]))}):n.forEach(n=>{r=Math.add(r,n[t])}),r};UtilJS.Array.Removes=function(n,t){let i=-1;do i=_.findIndex(n,function(n){return t(n)}),i>=0&&n.splice(i,1);while(i>=0)};UtilJS.Array.Remove=function(n,t){let i=_.findIndex(n,function(n){return t(n)});if(i<0){console.log(i);throw"Không tồn tại item xóa";}n.splice(i,1)};UtilJS.Array.RemoveAll=function(n){n.splice(0,n.length)};Object.defineProperty(Number.prototype,"ctmAdd",{enumerable:!1,value:function(n){let t=this.valueOf();return Math.add(t,n)}});Object.defineProperty(Number.prototype,"ctmSub",{enumerable:!1,value:function(n){let t=this.valueOf();return Math.subtraction(t,n)}});Object.defineProperty(Number.prototype,"ctmMul",{enumerable:!1,value:function(n){let t=this.valueOf();return Math.multiplication(t,n)}});Object.defineProperty(Number.prototype,"ctmDiv",{enumerable:!1,value:function(n){let t=this.valueOf();return Math.division(t,n)}});Object.defineProperty(Number.prototype,"ctmToString",{enumerable:!1,value:function(n){let t=this.valueOf();if(n){let i=parseInt(n.replace("N",""));return t.toFixed(i).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}return t.toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}});Object.defineProperty(Number.prototype,"BFormatter",{enumerable:!1,value:function(){let t=this.valueOf();var n;return t>=1e9?(n=(t/1e9).toFixed(0),n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+"B"):t>=1e6?(n=(t/1e6).toFixed(0),n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+"M"):t>=1e3?(n=(t/1e3).toFixed(0),n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+"K"):(n=t,n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}});Object.defineProperty(Number.prototype,"BFormatterNumber",{enumerable:!1,value:function(){let n=this.valueOf();var t=n;return n>1e9?t=(n/1e9).toFixed(1):n>1e6?t=(n/1e6).toFixed(0):n>1e3&&(t=(n/1e3).toFixed(0)),t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}});String.format||Object.defineProperty(String.prototype,"format",{enumerable:!1,value:function(n){var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})}});Object.defineProperty(String.prototype,"replaceAll",{enumerable:!1,value:function(n,t){var i=this;return i.replace(new RegExp(n,"g"),t)}});Object.defineProperty(String.prototype,"ctmRemove",{enumerable:!1,value:function(n){return this.substring(0,n)}});Object.defineProperty(String.prototype,"ctmSubString",{enumerable:!1,value:function(n,t){return this.substring(n,n+t)}});Object.defineProperty(Array.prototype,"ctmSum",{enumerable:!1,value:function(n){let i=this.valueOf(),t=0;return i.forEach(i=>{t=t.ctmAdd(n(i))}),t}});Object.defineProperty(Array.prototype,"ctmOrderBy",{enumerable:!1,value:function(n){let t=this.valueOf();return _.sortBy(t,t=>{let i=n(t);if(i){if(typeof i=="string"){let n=i.normalize();return n=n.toLowerCase(),UtilJS.String.RemoveUnicode(n)}}else return"";return i})}});Object.defineProperty(Array.prototype,"ctmOrderByDescending",{enumerable:!1,value:function(n){let t=this.valueOf();return t.ctmOrderBy(n).reverse()}});Object.defineProperty(Array.prototype,"ctmAverage",{enumerable:!1,value:function(n){let t=this.valueOf();return n===undefined?t.ctmSum(n=>n).ctmDiv(t.length):t.ctmSum(t=>n(t)).ctmDiv(t.length)}});Object.defineProperty(Array.prototype,"ctmFind",{enumerable:!1,value:function(n){let i=this.valueOf();for(var t=0;t<i.length;t++){let r=i[t];if(n(r))return r}}});Object.defineProperty(Array.prototype,"ctmDistinct",{enumerable:!1,value:function(){for(var t=[],n=0;n<this.length;n++)_.contains(t,this[n])||t.push(this[n]);return t}});Object.defineProperty(Array.prototype,"ctmGroupBy",{enumerable:!1,value:function(n){let t=this.valueOf();return t.reduce((t,i)=>{for(var u=i[n[0]],r=1;r<n.length;r++)u+="-"+i[n[r]];if(t[u]!=undefined)t[u].data.push(i);else{for(t[u]={},t[u].data=[],r=0;r<n.length;r++)t[u][n[r]]=i[n[r]];t[u].data.push(i)}return t},{})}});Object.defineProperty(Array.prototype,"ctmMax",{enumerable:!1,value:function(n){let t=this.valueOf();return Math.max.apply(null,t.filter(t=>n(t)))}});Object.defineProperty(Array.prototype,"ctmAny",{get:function(){let n=this.valueOf();return n.length>0}});Object.defineProperty(Array.prototype,"ctmFirst",{get:function(){return this[0]}});Object.defineProperty(Array.prototype,"ctmLast",{get:function(){return this[this.length-1]}});Object.defineProperty(Date.prototype,"ctmMonth",{get:function(){return this.getMonth()+1}});Object.defineProperty(String.prototype,"ctmToLower",{enumerable:!1,value:function(){let n=this.normalize();return n.toLowerCase()}});Object.defineProperty(Date.prototype,"ctmTotalDays",{get:function(){return this.getTime()/864e5}});Object.defineProperty(Date.prototype,"ctmYear",{get:function(){return this.getFullYear()}});Object.defineProperty(Date.prototype,"ctmAddDays",{enumerable:!1,value:function(n){var t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t}});Object.defineProperty(Date.prototype,"ctmAddMonths",{enumerable:!1,value:function(n){var t=new Date(this.getTime());return new Date(t.setMonth(t.getMonth()+n))}});Object.defineProperty(Date.prototype,"ctmToString",{enumerable:!1,value:function(n){return moment(this).format(n)}});Object.defineProperty(Object.prototype,"ctmSelect",{value:function(n){let t=[];for(var i in this)t.push(n(this[i]));return t},enumerable:!1,configurable:!0});Object.defineProperty(String.prototype,"ctmCapitalize",{enumerable:!1,value:function(){return this.toLowerCase().replace(/\b./g,function(n){return n.toUpperCase()})}});MasterPageController=function(n,t,i,r,u,f,e,o){t.MasterPage={IsLoading:!1};t.UserPricinpal={};t.DataRoot={};t.InitUserPrincipal=function(n,i){try{e.remove("UserPricinpal");n&&n.UserPermission&&n.UserPermission.length>0&&(n.UserPermission=n.UserPermission.map(n=>n.RoleFunctionName).filter((n,t,i)=>i.indexOf(n)===t));e.setObject("UserPricinpal",n);i&&(t.UserPricinpal.Token=n.Token,t.UserPricinpal.ExpireDate=n.ExpireDate)}catch(r){o.WriteLogServerError(r,"UserPricinpal.InitUserPrincipal")}};MasterData.NeedUpdate&&(MasterData.objUserPrincipal===undefined&&(MasterData.objUserPrincipal={}),t.InitUserPrincipal(MasterData.objUserPrincipal));t.UserPricinpal=e.getObject("UserPricinpal");t.UserPricinpal||(t.UserPricinpal={});MasterData.UserIDCurrent!==t.UserPricinpal.UserID&&(e.remove("UserPricinpal"),t.UserPricinpal={});t.MasterPage.RemoveCache=function(){i(function(){u.PostDataAjax("/OutputCaches/Remove",{},function(){},function(n){i(function(){if(n.objCodeStep.Status=="Error"){jAlert.Error(n.objCodeStep.Message);return}if(n.objCodeStep.Status=="Success"){jAlert.Success("Xóa Outputcache thành công");return}},100)},function(){return})})};t.UserPricinpal.IsInRole=function(n){let t=e.getObject("UserPricinpal");if(!t)return!1;let i=_.filter(t.UserPermission,function(t){return n==t?!0:!1});return i.length==0?!1:!0};t.UserPricinpal.IsAllowDepartment=function(n){return _.find(t.UserPricinpal.UserRoleDepartmentIDs,t=>t==n)!==undefined};t.scrollToTopInputValid=function(){$($(".has-error")[0])!=undefined&&$("html, body").animate({scrollTop:$($(".has-error")[0]).offset().top},"slow")};t.OutputTypeEnum=OutputTypeEnum};MasterPageController.$inject=["$scope","$rootScope","$timeout","$filter","CommonFactory","UtilFactory","$localstorage","ApiHelper"];fileAttachUpload=function(n,t,i,r,u,f){return{restrict:"E",transclude:!0,scope:{myroot:"="},templateUrl:"/script-handler/app/directives/file-attach-upload/file-attach-upload.html",link:function(n,i){function r(){this.IsDeleted=!1;this.Base64="";this.Src="";this.DataType="";this.Http=new XMLHttpRequest;this.FileInput={};this.Percent=0;this.FileName=""}n.myroot||(n.myroot={});n.myroot.Core||(n.myroot.Core={});n.myroot.Core.IsListenProgress||(n.myroot.Core.IsListenProgress=!0);n.myroot.Core.Accept||(n.myroot.Core.Accept="*");n.myroot.Core.IsMultipleFile||(n.myroot.Core.IsMultipleFile=!1);n.myroot.IsListenProgress=n.myroot.Core.IsListenProgress;n.myroot.IsMultipleFile=n.myroot.Core.IsMultipleFile;n.myroot.LstFile=[];n.btnOpenDialog=i[0].querySelector(".btnOpenDialog");n.input=i[0].querySelector(".files");n.btnOpenDialog&&n.btnOpenDialog.addEventListener("click",function(){t(()=>{angular.element(n.input).trigger("click")})});n.input.addEventListener("change",function(i){if(!f.CheckToken()){UtilJS.Loading.Hide();return}t(()=>{var f=i.target.files,c,o,t,h;if(f.length!=0){c=f[0].size;let s=2;if(MasterData.MaxSizeUpload&&(s=MasterData.MaxSizeUpload),c>s*1048576){jAlert.Warning("Đính kèm không vượt quá "+s+" MB.");return}if(!n.myroot.IsMultipleFile&&(n.myroot.LstFile=[],f.length>1)){jAlert.Warning("Vui lòng up 1 file");return}if(UtilJS.String.IsContain(f[0].name,",")){jAlert.Warning('Tên file không hợp lệ. Vui lòng xóa dấu "," và thử lại');return}for(o=0;o<f.length;o++)t=new r,t.FileInput=f[o],t.FileName=f[o].name.normalize(),n.myroot.IsListenProgress&&(t.AlertNotFoundTimeout=!1,u(t),e(t)),n.myroot.LstFile.push(t),n.myroot.IsMultipleFile||(UtilJS.Loading.Show(),n.myroot.CallBack.UploadBegin&&n.myroot.CallBack.UploadBegin(t),t.Http.open("POST","/Directives/UploadFileToGCS/",!0),h=new FormData,h.append("file",t.FileInput),n.myroot.SubModuleName&&t.Http.setRequestHeader("subModuleName",n.myroot.SubModuleName),t.Http.send(h))}}).then(()=>{angular.element(n.input).val(null)})});n.myroot.API={};n.myroot.API.ClearLstItem=()=>{n.myroot.LstFile=[]};n.myroot.API.ResetItem=function(n){n.Percent=0;n.FileName="";n.FilePathSaved=""};n.myroot.CallBack||(n.myroot.CallBack={});var u=function(n){n.Http.upload.addEventListener("progress",function(i){t(()=>{fileLoaded=i.loaded,fileTotal=i.total,fileProgress=parseInt(fileLoaded/fileTotal*100)||0,n.Percent=fileProgress},50)},!1)},e=function(i){i.Http.onreadystatechange=function(){i.Http.readyState==4&&i.Http.status==200?t(()=>{var t=JSON.parse(i.Http.responseText);UtilJS.Loading.Hide();i.Percent=100;let r=t.Data;Object.assign(i,r);i.IsSuccess=!0;n.myroot.CallBack.UploadDone&&n.myroot.CallBack.UploadDone(i);return},200):i.Http.readyState==4&&i.Http.status!=200&&(t.cancel(i.AlertNotFoundTimeout),i.AlertNotFoundTimeout=t(()=>{i.Http.status==404?jAlert.Error("Định dạng file không đúng.","Thông báo"):i.Http.status==401?jAlert.Warning("Phiên làm việc đã hết hạn, vui lòng đăng nhập lại."):i.Http.status==0?jAlert.Warning("Server không phản hồi"):(jAlert.Error("Lỗi status "+i.Http.status,"Thông báo"),console.log(i.Http));i.Percent=0;i.FileName="";UtilJS.Loading.Hide();i.IsSuccess=!1;n.myroot.CallBack.UploadDone&&n.myroot.CallBack.UploadDone(i);return},200));n.$apply()}};n.myroot.OpenBrowse=()=>{n.myroot.Core.IsOpenBrowse()&&t(()=>{n.input.click()})};n.myroot.IsReady=!0}}};fileAttachUpload.$inject=["$q","$timeout","CommonFactory","$localstorage","$rootScope","ApiHelper"];lazyLoadMore=function(){return{restrict:"A",link:function(n,t){var i=t[0];$(i).bind("scroll",function(){i.scrollTop+i.offsetHeight>=i.scrollHeight&&n.$apply("LoadMore()")})}}};lazyLoadMore.$inject=[];customSelect2=function(n,t){return{restrict:"E",scope:{myroot:"="},templateUrl:"/script-handler/app/directives/custom-select2/custom-select2.html",link:function(i,r,u){if(i.myroot.UpdateValueSelected=function(t){clearInterval(i.myroot.myTimer);let u=n.defer();return i.myroot.myTimer=setInterval(()=>{i.myroot.IsFinishRender&&(i.myroot.IsDebug,t!==undefined&&(i.myroot.Value=t),clearInterval(i.myroot.myTimer),i.SetValid(i.myroot.Value),i.myControl.val(i.myroot.Value),i.myControl_s2id=$(r[0]).find(".select2-container"),i.myControl_s2id.select2("val",i.myroot.Value),u.resolve(i.myroot.Value))},100),u.promise},i.SetValid=function(n,t){n===""?$("input[name="+i.myroot.ID+"]").val(""):$("input[name="+i.myroot.ID+"]").val(n);try{t&&$("input[name="+i.myroot.ID+"]").valid()}catch(r){}},i.myControl=$(r[0]).find(".myControl"),i.myroot.IsDebug,i.myroot.Core.Label?i.myroot.Core.label2=i.myroot.Core.Label:i.myroot.Core.label=u.label,i.myroot.Core.label2||(i.myroot.Core.label2="Chọn "+u.label.charAt(0).toLowerCase()+u.label.slice(1)),i.myroot.ID=u.myroot.replace(".","_"),i.myroot.IsFinishRender=!i.myroot.Lst||i.myroot.Lst&&i.myroot.Lst.length==0,i.myroot.API||(i.myroot.API={}),i.myroot.CallBack||(i.myroot.CallBack={}),i.myroot.Core.ValueDefault||(i.myroot.Core.ValueDefault=""),i.myroot.ValueOrginal="",i.myroot.Value?(i.myroot.ValueOrginal=i.myroot.Value,i.myroot.Value=i.myroot.Value.toString()):i.myroot.Value=i.myroot.Core.ValueDefault,i.myroot.Onchange=function(){t.isCustomSelect2Enable||(i.myroot.IsDebug,i.SetValid(i.myroot.Value,!0),i.myroot.CallBack.OnValuechanged&&i.myroot.CallBack.OnValuechanged(i.myroot.Value),i.myroot.CallBack.Onchanged&&i.myroot.CallBack.Onchanged())},i.myroot.API.DiscardChange=function(){i.myroot.API.SetValue(i.myroot.ValueOrginal,!0)},i.myroot.API.SetValue=function(n,t){try{i.myroot.IsDebug;(n===null||n===undefined)&&(n=i.myroot.Core.ValueDefault);i.myroot.ValueOrginal=n;i.myroot.Value=n.toString();i.myroot.UpdateValueSelected().then(n=>{i.myroot.IsDebug,t||i.myroot.CallBack.OnValuechanged&&i.myroot.CallBack.OnValuechanged(n)})}catch(r){throw r;}},i.myroot.API.DataSource=function(n,t){i.myroot.IsDebug;i.myroot.Lst=n;i.myroot.UpdateValueSelected(t)},i.myroot.API.OnStart=function(){i.myroot.IsDebug;i.myroot.IsFinishRender=!1},i.myroot.API.OnEnd=function(){i.myroot.IsDebug;i.myroot.IsFinishRender=!0},t.beginBlockAllSelect2=function(){t.isCustomSelect2Enable=!0},t.endBlockAllSelect2=function(){t.isCustomSelect2Enable=!1},i.myroot.UpdateValueSelected(),i.myControl.select2(),i.myroot.CallBack&&i.myroot.CallBack.OnOpenSelect2)$(r[0]).on("select2-open",function(){i.myroot.CallBack.OnOpenSelect2()});i.myroot.IsReady=!0}}};customSelect2.$inject=["$q","$rootScope"];dateTimePicker=function(){return{restrict:"E",scope:{myroot:"="},templateUrl:"/script-handler/app/directives/date-time-picker/date-time-picker.html",link:function(n,t,i){n.input=$(t[0]).find(".myDtm");n.myroot.API||(n.myroot.API={});n.myroot.CallBack||(n.myroot.CallBack={});n.myroot.ID=i.myroot.replace(".","_");n.myroot.Core.showTodayButton=!0;n.myroot.Core.showClear=!0;n.myroot.Core.showClose=!0;n.myroot.Core.label=i.label;n.myroot.Core.DateType=="DateTime"?(n.myroot.Core.FormatValueDisplay||(n.myroot.Core.format="DD/MM/YYYY HH:mm"),n.myroot.Core.FormatValue||(n.myroot.Core.FormatValue="MM/DD/YYYY HH:mm")):(n.myroot.Core.FormatValueDisplay||(n.myroot.Core.format="DD/MM/YYYY"),n.myroot.Core.FormatValue||(n.myroot.Core.FormatValue="MM/DD/YYYY"));n.myroot.ValueOrginal=undefined;n.myroot.Value?(n.myroot.ValueOrginal=n.myroot.Value,n.myroot.ValueDisplay=moment(n.myroot.Value).format(n.myroot.Core.format),n.myroot.Value=moment(n.myroot.Value).format(n.myroot.Core.FormatValue)):n.myroot.Value=null;n.myroot.API.SetValue=function(t,i){try{n.myroot.IsDebug;n.myroot.ValueOrginal=t;t===null||t===undefined?(n.myroot.ValueDisplay=null,n.myroot.Value=null):(n.myroot.ValueDisplay=moment(t).format(n.myroot.Core.format),n.myroot.Value=moment(t).format(n.myroot.Core.FormatValue));$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);!i&&n.myroot.CallBack.OnValuechanged&&n.myroot.CallBack.OnValuechanged(n.myroot.Value)}catch(r){throw r;}};n.myroot.config={};n.myroot.config.format=n.myroot.Core.format;n.myroot.config.showTodayButton=!0;n.myroot.config.showClear=!0;n.myroot.config.showClose=!0;n.myroot.config.minDate=n.myroot.Core.MinDate?n.myroot.Core.MinDate:new Date(0);n.myroot.Core.UseCurrent!=undefined&&(n.myroot.config.useCurrent=n.myroot.Core.UseCurrent);n.input.datetimepicker(n.myroot.config);n.input.on("dp.change",function(t){n.myroot.IsDebug;t.date?(n.myroot.ValueDisplay=n.input.val(),n.myroot.Value=moment(t.date).format(n.myroot.Core.FormatValue)):(n.myroot.ValueDisplay=null,n.myroot.Value=null);$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);try{$("input[name="+n.myroot.ID+"]").valid()}catch(t){}n.myroot.CallBack.OnValuechanged&&n.myroot.CallBack.OnValuechanged(n.myroot.Value)});n.myroot.API.SetMinDate=function(t){n.myroot.IsDebug;moment(t).isValid()&&(t=moment(t)._d,n.input.data("DateTimePicker").minDate(t))};n.myroot.API.SetMinTime=function(t){if(n.myroot.IsDebug,moment(t).isValid()){let i=moment(t).format("HH:mm");n.input.setOptions({minTime:i})}};n.myroot.API.SetMaxDate=function(t){n.myroot.IsDebug;moment(t).isValid()&&(t=moment(t)._d,n.input.data("DateTimePicker").maxDate(t))};$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);n.myroot.IsReady=!0}}};dateTimePicker.$inject=[];formatMoney=function(n,t){return{require:"?ngModel",restrict:"A",scope:{myModel:"=",precision:"=",formatMoneyNoInput:"="},link:function(n,i){(n.precision==null||n.precision==undefined)&&(n.precision=0);i.maskMoney({allowNegative:!0,thousands:",",decimal:".",affixesStay:!1,allowZero:!0,precision:n.precision});i.keydown(function(r){var u=String.fromCharCode(r.which);if(_.contains(n.formatMoneyNoInput,u)){r.preventDefault();return}t(function(){n.myModel=parseFloat(i.val().replace(new RegExp(",","g"),""));i.trigger("change")})});n.$watch("myModel",function(){$.isNumeric(n.myModel)&&n.myModel.toString().indexOf(".")>0?i.val(n.myModel.toFixed(n.precision)).trigger("mask.maskMoney"):i.val(n.myModel).trigger("mask.maskMoney")})}}};formatMoney.$inject=["$filter","$timeout"];getWidth=function(n,t){return{restrict:"A",scope:{getWidth:"="},link:function(n,i){$(function(){n.getWidth=i[0].offsetWidth;t(function(){n.getWidth=i[0].offsetWidth},500)})}}};getWidth.$inject=["$timeout","$interval"];getHeight=function(n,t){return{restrict:"A",scope:{getHeight:"="},link:function(n,i){$(function(){n.getHeight=i[0].offsetHeight;t(function(){n.getHeight=i[0].offsetHeight},500)})}}};getHeight.$inject=["$timeout","$interval"];lazyLoad=function(n,t){return{restrict:"A",scope:{fncallback:"&lazyLoad"},link:function(n,i){n.IsLoaded=!1;n.raw=i[0];angular.element(t).bind("scroll",function(){var i=$(n.raw).is(":visible"),t;!n.IsLoaded&&i&&(t=$(n.raw).position().top,this.pageYOffset+this.innerHeight>=t&&(n.fncallback(),n.IsLoaded=!0,n.$apply()))})}}};lazyLoad.$inject=["$timeout","$window"];noInput=function(){return{restrict:"A",scope:{noInput:"="},link:function(n,t){t.bind("keydown keypress",function(t){var i=String.fromCharCode(t.which);_.contains(n.noInput,i)&&t.preventDefault()})}}};noInput.$inject=[];whenEnter=function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.whenEnter)}),t.preventDefault())})}};whenEnter.$inject=[];compile=function(n){return function(t,i,r){t.$watch(function(n){return n.$eval(r.compile)},function(r){i.html(r);n(i.contents())(t)})}};compile.$inject=["$compile"];paginationStyle1=function(n){return{restrict:"E",scope:{pager:"=",totalItems:"=",fnCallBack:"&"},templateUrl:"/script-handler/app/directives/pagination-style/pagination-style.html",link:function(t){function i(){if(!t.pager.CurrentPage||t.pager.CurrentPage<1||t.pager.CurrentPage>t.pager.TotalPages){t.pager.Pages=[];return}if(!t.pager.TotalPages){t.pager.Pages=[];return}r(t.pager.TotalItems,t.pager.CurrentPage,t.pager.PageSize)}function r(n,i,r){var o,e,c,v,l,u;i=i||1;r=r||10;o=t.pager.StartPage||1;e=t.pager.EndPage||10;var s=10,f=[],h=Math.floor(t.pager.TotalPages/s),a=t.pager.TotalPages%s;for(u=1;u<=h;u++)c=(u-1)*r,v=c+s,f.push({Start:c+1,End:v});for(a>0&&f.push({Start:h*s+1,End:h*s+a}),l=!1,u=0;u<f.length;u++)if(i>=f[u].Start&&i<=f[u].End){o=f[u].Start;e=f[u].End;e>10&&e-o<9&&(o=e-9);l=!0;break}l||(i=f[0].Start,o=f[0].Start,e=f[0].End);var y=(i-1)*r,w=Math.min(y+r-1,n-1),p=[];for(u=o;u<=e;u++)p.push(u);i<=0&&(i=1);t.pager.PageSize=r;t.pager.StartPage=o;t.pager.EndPage=e;t.pager.StartIndex=y;t.pager.EndIndex=w;t.pager.Pages=p}t.pager.TotalItems=0;t.pager.TotalPages=0;t.$watch("totalItems",function(){t.pager.TotalItems=t.totalItems;t.InitPager()});t.$watch("pager.CurrentPage",function(){t.InitPager()});t.InitPager=function(){n(function(){t.pager.TotalPages=Math.ceil(t.pager.TotalItems/t.pager.PageSize);t.pager.CurrentPage>t.pager.TotalPages&&(t.pager.CurrentPage=t.pager.TotalPages,t.pager.TotalPages==0&&(t.pager.CurrentPage=1));i()})};t.Exec=function(n){n>t.pager.TotalPages||t.fnCallBack({PageClicked:n})};t.ExecFirst=function(n){n>t.pager.TotalPages&&(n=t.pager.TotalPages);n<=0&&(n=1);t.pager.StartPage=t.pager.StartPage-10;t.pager.EndPage=t.pager.EndPage-10;t.pager.StartPage<=0&&(t.pager.StartPage=1,t.pager.EndPage=10);t.fnCallBack({PageClicked:n})};t.ExecLast=function(n){n>t.pager.TotalPages&&(n=t.pager.TotalPages);t.pager.StartPage=t.pager.EndPage+1;t.pager.EndPage=t.pager.StartPage+9;t.pager.EndPage>t.pager.TotalPages&&(t.pager.EndPage=t.pager.TotalPages,t.pager.StartPage=t.pager.EndPage-9);t.fnCallBack({PageClicked:n})};t.pager.GetPageIndexReLoad=function(n){return t.pager.CurrentPage<t.pager.TotalPages?t.pager.CurrentPage:n%t.pager.PageSize>0?t.pager.CurrentPage:t.pager.CurrentPage-1}}}};paginationStyle1.$inject=["$timeout"];paginationStyle2=function(n){return{restrict:"E",scope:{pager:"=",totalItems:"=",fnCallBack:"&"},templateUrl:"/script-handler/app/directives/pagination-style2/pagination-style2.html",link:function(t){t.pager.MaxPage=-1;t.$watch("totalItems",function(){t.pager.TotalItems=t.totalItems;t.pager.MaxPage=-1;t.InitPager()});t.$watch("pager.CurrentPage",function(){t.InitPager()});t.InitPager=function(){n(function(){var n=(t.pager.CurrentPage-1)*t.pager.PageSize,i=n+t.pager.PageSize;t.pager.StartIndex=n;i>=t.pager.TotalItems&&(t.pager.MaxPage=t.pager.CurrentPage)})};t.Exec=function(n){t.pager.MaxPage>-1&&n>t.pager.MaxPage||n<=0||t.fnCallBack({PageClicked:n})}}}};paginationStyle2.$inject=["$timeout"];inputFormat=function(n){return{require:"?ngModel",restrict:"A",link:function(t,i,r,u){function f(u,f){var o="",e="";if(u===""||u===null||u===undefined)return 0;if(o=u.toString(),e=o.replace(/,/g,"").replace(/[A-Za-z]/g,""),e=parseFloat(e),e=isNaN(e)?"":e.toString(),e=o.length===1&&o[0]==="-"?o[0]:o.length===1&&o[0]==="0"?"0":t.allowdecimal?n(r.inputFormat)(e?e:0,8):n(r.inputFormat)(e?e:0),r.integer||(e.indexOf(".")===-1?o.slice(-1)==="."?e+=".":o.slice(-2)===".0"?e+=".0":o.slice(-3)===".00"?e+=".00":o.slice(-4)===".000"?e+=".000":o.slice(-5)===".0000"?e+=".0000":o.slice(-6)===".00000"?e+=".00000":o.slice(-7)===".000000"?e+=".000000":o.slice(-8)===".0000000"&&(e+=".0000000"):o.slice(-1)==="0"&&(e=o)),r.positive&&e[0]==="-"&&(e=e.substring(1)),typeof f!="undefined")return e===""?0:e;i.val(e==="0"?"0":e).trigger("change")}function e(n){var t=n.toString().replace(/,/g,"").replace(/[A-Za-z]/g,"");return t=parseFloat(t),t=isNaN(t)?0:t,r.positive&&(t=Math.abs(t)),t}u!=null&&(u.$formatters.push(function(n){return f(n,!0)}),u.$parsers.push(function(n){return f(n),e(n)}),i.bind("keypress",function(n){var u=n.which||n.keyCode,e=r.allowDecimal=="true"?!0:!1;t.allowdecimal=e;u>47&&u<58||u==8||u==9||u==190||u==39||u==37||u==43||e&&u==46?f(i.val()):n.preventDefault()}))}}};inputFormat.$inject=["$filter"];$localstorage=function(n){return{set:function(t,i){n.localStorage[t]=i},get:function(t,i){return n.localStorage[t]||i},setObject:function(t,i){n.localStorage[t]=JSON.stringify(i)},getObject:function(t){try{var i=n.localStorage[t];if(i)return JSON.parse(i||"{}")}catch(r){return JSON.parse("{}")}},remove:function(t){n.localStorage.removeItem(t)},clearAll:function(){n.localStorage.clear()}}};$localstorage.$inject=["$window"];CommonFactory=function(n,t,i,r,u,f){var e={};return e.CodeStep={Status:"",StatusCode:0,ErrorStep:"",Message:"",ErrorMessage:"",Data:""},e.JsonStatusCode={Success:"Success",Error:"Error",Warning:"Warning",Info:"Info"},e.WriteLog=function(n,t){MasterData.APIDebug&&console.log(n,JSON.stringify(t))},e.WriteLogServerError=function(n,t,i){i||(i=UtilJS.guid().replace(/-/g,""));t=t?t+"/n/n":"";let r=t+JSON.stringify({message:n.message,stack:n.stack});e.WriteLogServer(r,i)},e.WriteLogServer=function(t,i){var u={type:"APIHelper",data:t,url:window.location.href},r={method:"POST",url:"/ClientLogs/consolescript",headers:{Accept:"application/json",UserID:n.UserPricinpal.Username},data:u};i!=undefined&&i!=""&&(r.headers.ContextID=i);f(r).then(function(){})},e.PostDataAjax=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"POST",dataType:"json",data:t,beforeSend:u,success:function(n){i(function(){f(n)})},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjax() error :"+h)}},e.GetDataAjax=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"GET",dataType:"json",data:t,beforeSend:u,success:function(n){i(function(){f(n)})},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjax() error :"+h)}},e.PostDataAjaxAsync=function(n,t,u,f,o,s){try{s||(s=6e4);$.ajax({url:n,type:"POST",dataType:"json",data:t,beforeSend:u,"async":!1,success:function(n){f(n)},error:function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else r.Alert.RequestError(n),i(function(){o(n)})},complete:function(){}}).always(function(){})}catch(h){console.log("CommonFactory.PostDataAjaxAsync() error :"+h)}},e.PostPromise=function(n,t){var i=u.defer();return f({method:"POST",url:n,data:t}).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise},e.GetPromise=function(n,t){var i=u.defer();return f({method:"GET",url:n,params:t}).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise},e.HttpPostMethod=function(n,i,r){r&&r.CacheKeyClient&&t.remove(r.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let o=u.defer();var h={method:"POST",url:n,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest",TabBrowserKey:MasterData.TabBrowserKey},data:i};return e.WriteLog(n,i),f(h).then(function(n){let t=n.data;t.objCodeStep.Status==e.JsonStatusCode.Error||t.objCodeStep.Status==e.JsonStatusCode.Warning?o.reject(t):o.resolve(t)},function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else n.objCodeStep={},n.objCodeStep.Status=e.JsonStatusCode.Error,n.objCodeStep.Message=e.StatusCodeMessage(n.status),o.reject(n)}),o.promise},e.PostMethod=function(n,r,f){f&&f.CacheKeyClient&&t.remove(f.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let o=u.defer();return e.PostDataAjax(n,r,function(){},function(n){i(function(){n.objCodeStep.Status!="Success"&&o.reject(n);n.objCodeStep.Status=="Success"&&o.resolve(n)},100)},function(){o.reject(err)}),o.promise},e.GetMethod=function(n,i,r){r&&r.CacheKeyClient&&t.remove(r.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let o=u.defer();var h={method:"GET",url:n,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},data:i};return e.WriteLog(n,i),f(h).then(function(n){let t=n.data;t.objCodeStep.Status==e.JsonStatusCode.Error||t.objCodeStep.Status==e.JsonStatusCode.Warning?o.reject(t):o.resolve(t)},function(n){if(n.status==401||n.status==440||n.status==0||n.status==-1)e.ConfirmRedirectLogin({status:401});else n.objCodeStep={},n.objCodeStep.Status=e.JsonStatusCode.Error,n.objCodeStep.Message=e.StatusCodeMessage(n.status),o.reject(n)}),o.promise},e.StatusCodeMessage=function(n){var t="";switch(n){case 400:t="Lỗi dữ liệu không hợp lệ";break;case 401:t="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:t="Bạn không có quyền thực hiện thao tác này.";break;case 404:t="URL action không chính xác";break;case 405:t="Phương thức không được chấp nhận";break;case 500:t="Lỗi hệ thống";break;case 502:t="Đường truyền kém";break;case 503:t="Dịch vụ không hợp lệ";break;case 504:t="Hết thời gian chờ";break;case 440:t="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:t="Lỗi chưa xác định"}return t},e.ConfirmRedirectLogin=function(t){if(i(()=>{UtilJS.Loading.Hide()},500),!n.IsShowConfirmRedirectLogin){n.IsShowConfirmRedirectLogin=!0;let r="Phiên đăng nhập hết hạn, vui lòng bấm đồng ý để đăng nhập lại";t!==undefined&&t.Message&&(r=t.Message);$.confirm({title:"Thông báo!",content:r,buttons:{formSubmit:{text:'<i class="fa fa-check-circle"><\/i> Đồng ý',btnClass:"btn cc-btn-style cc-btn-color-blue",action:function(){n.IsShowConfirmRedirectLogin=!1;UtilJS.openReLogin()}},formSubmit2:{text:"Hủy",btnClass:"btn cc-btn-style",action:function(){n.IsShowConfirmRedirectLogin=!1}}}})}},e};CommonFactory.$inject=["$rootScope","$localstorage","$timeout","UtilFactory","$q","$http"];ApiHelper=function(n,t,i,r,u){var f={};return f.CodeStep={Status:"",StatusCode:0,ErrorStep:"",Message:"",ErrorMessage:"",Data:""},f.JsonStatusCode={Success:"Success",Error:"Error",Warning:"Warning",Info:"Info"},f.WriteLog=function(n,t){MasterData.APIDebug&&console.log(n,JSON.stringify(t))},f.WriteLogServerError=function(n,t,i){i||(i=UtilJS.guid().replace(/-/g,""));t=t?t+"/n/n":"";let r=t+JSON.stringify({message:n.message,stack:n.stack});f.WriteLogServer(r,i)},f.WriteLogServer=function(t,i){var f={type:"APIHelper",data:t,url:window.location.href},r={method:"POST",url:"/ClientLogs/consolescript",headers:{Accept:"application/json",UserID:n.UserPricinpal.Username},data:f};i!=undefined&&i!=""&&(r.headers.ContextID=i);u(r).then(function(){})},f.JsCaching={},f.JsCaching.GetCache=n=>DataCacheKey[n.CacheKeyClient],f.JsCaching.GetCachePromise=n=>{let u=r.defer(),t=DataCacheKey[n.CacheKeyClient];var i=document.createElement("script");return i.type="text/javascript",i.src=`/CacheStorerages/CreateCacheJS?CacheKeyClient=${n.CacheKeyClient}&Version=${t.Version}`,document.body.appendChild(i),n.Timer=setInterval(()=>{let i={};if(t=f.JsCaching.GetCache(n),t&&t.StatusCode!==undefined&&t.StatusCode!==200){clearInterval(n.Timer);f.ConfirmRedirectLogin(t);return}t&&t.Data!==undefined&&(i.Data=t.Data,clearInterval(n.Timer),typeof i.Data=="array"&&(i.Data=_.map(i.Data,_.clone)),u.resolve(i))},100),u.promise},f.GetHTML=function(t,i){let e=r.defer(),o=jQuery.extend({},ApiHelper.CodeStep);if(o.ContextID=UtilJS.guid().replace(/-/g,""),!f.CheckToken())return UtilJS.Loading.Hide(),e.reject(o),e.promise;var s={method:"GET",url:t,headers:{Authorization:"Bearer "+n.UserPricinpal.Token,Accept:"application/json",ContextID:o.ContextID,UserID:n.UserPricinpal.Username,SessionID:MasterData.SessID},data:i};return f.WriteLog(t,i),u(s).then(function(n){n.status==204?e.reject(""):e.resolve(n.data)},function(){e.reject("")}),e.promise},f.GetMethod=function(t,i,e){let s=r.defer(),o=jQuery.extend({},ApiHelper.CodeStep);if(o.ContextID=UtilJS.guid().replace(/-/g,""),!f.CheckToken())return UtilJS.Loading.Hide(),s.reject(o),s.promise;if(e&&e.CacheKeyClient)return f.JsCaching.GetCachePromise(e);var h={method:"GET",url:t,headers:{Authorization:"Bearer "+n.UserPricinpal.Token,Accept:"application/json",ContextID:o.ContextID,UserID:n.UserPricinpal.Username,SessionID:MasterData.SessID},data:i};return f.WriteLog(t,i),u(h).then(function(n){n.status==204?(o=f.SetErrorAPI(n,t,o.ContextID),s.reject(o)):(o.Status=f.JsonStatusCode.Success,o.Data=n.data,s.resolve(o))},function(n){o=f.SetErrorAPI(n,t,o.ContextID);s.reject(o)}),s.promise},f.PostMethod=function(i,e,o){o&&o.CacheKeyClient&&t.remove(o.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let h=r.defer();if(!f.CheckToken())return UtilJS.Loading.Hide(),h.reject(s),h.promise;var c={method:"POST",url:i,headers:{Authorization:"Bearer "+n.UserPricinpal.Token,Accept:"application/json",ContextID:s.ContextID,UserID:n.UserPricinpal.Username,SessionID:MasterData.SessID},data:e};return f.WriteLog(i,e),u(c).then(function(n){n.status==204?(s=f.SetErrorAPI(n,i,s.ContextID),h.reject(s)):(s.Status=f.JsonStatusCode.Success,s.Data=n.data,h.resolve(s))},function(n){s=f.SetErrorAPI(n,i,s.ContextID);h.reject(s)}),h.promise},f.PutMethod=function(i,e,o){o&&o.CacheKeyClient&&t.remove(o.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let h=r.defer();if(!f.CheckToken())return UtilJS.Loading.Hide(),h.reject(s),h.promise;var c={method:"PUT",url:i,headers:{Authorization:"Bearer "+n.UserPricinpal.Token,Accept:"application/json",ContextID:s.ContextID,UserID:n.UserPricinpal.Username,SessionID:MasterData.SessID},data:e};return f.WriteLog(i,e),u(c).then(function(n){n.status==204?(s=f.SetErrorAPI(n,i,s.ContextID),h.reject(s)):(s.Status=f.JsonStatusCode.Success,s.Data=n.data,h.resolve(s))},function(n){s=f.SetErrorAPI(n,i,s.ContextID);h.reject(s)}),h.promise},f.DeleteMethod=function(i,e,o){o&&o.CacheKeyClient&&t.remove(o.CacheKeyClient);let s=jQuery.extend({},ApiHelper.CodeStep);s.ContextID=UtilJS.guid().replace(/-/g,"");let h=r.defer();if(!f.CheckToken())return UtilJS.Loading.Hide(),h.reject(s),h.promise;var c={method:"DELETE",url:i,headers:{Authorization:"Bearer "+n.UserPricinpal.Token,Accept:"application/json",ContextID:s.ContextID,UserID:n.UserPricinpal.Username,SessionID:MasterData.SessID},data:e};return f.WriteLog(i,e),u(c).then(function(n){n.status==204?(s=f.SetErrorAPI(n,i,s.ContextID),h.reject(s)):(s.Status=f.JsonStatusCode.Success,s.Data=n.data,h.resolve(s))},function(n){s=f.SetErrorAPI(n,i,s.ContextID);h.reject(s)}),h.promise},f.PostPromise=function(n,t,i,f,e){var o=r.defer();return u({method:t,url:n,data:i}).then(function(n){f&&f(n);o.resolve(n)},function(n){e&&e(n);o.reject(n)}),o.promise},f.RemoveCache=function(n){ApiHelper.GetMethod(url,{CacheKey:n},function(){},function(){},function(){})},f.SetErrorAPI=function(t,i,r){var u=jQuery.extend({},f.CodeStep),e;if(t.status!=200&&t.status!=201){u.Status=f.JsonStatusCode.Error;u.StatusCode=t.status;u.ErrorStep="API error "+t.status+", ApiEndPoint:"+i;switch(t.status){case 400:e=t.data;u.ErrorMessage=e;jQuery.type(e)=="array"&&(u.ErrorMessage=e.join("<\/br>"));u.Message=f.StatusCodeMessage(t.status);f.WriteLogServer(u.Message,r);break;case 406:e=t.data;u.Status=f.JsonStatusCode.Warning;u.Message=e;jQuery.type(e)=="array"&&(u.Message=e.join("<\/br>"));f.WriteLogServer(u.Message,r);break;case 500:u.ErrorMessage=t.data;u.Message=f.StatusCodeMessage(t.status);break;case 204:u.Message="Không có dữ liệu hoặc bạn không có quyền xem dữ liệu";u.Status=f.JsonStatusCode.Warning;break;case 401:let i={};i.Token=n.UserPricinpal.Token;i.ExpireDate=n.UserPricinpal.ExpireDate;f.WriteLogServer("401 API Token hết hạn: "+JSON.stringify(i),r);u.Status="";f.ConfirmRedirectLogin({status:401,IsOnlyShowAlert:!0});break;default:u.Message=f.StatusCodeMessage(t.status)}return u}},f.StatusCodeMessage=function(n){var t="";switch(n){case 400:t="Lỗi dữ liệu không hợp lệ";break;case 401:t="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:t="Bạn không có quyền thực hiện thao tác này.";break;case 404:t="URL action không chính xác";break;case 405:t="Phương thức không được chấp nhận";break;case 500:t="Lỗi hệ thống";break;case 502:t="Đường truyền kém";break;case 503:t="Dịch vụ không hợp lệ";break;case 504:t="Hết thời gian chờ";break;case 440:t="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:t="Lỗi chưa xác định"}return t},f.CheckToken=function(){return!0;var t},f.ConfirmRedirectLogin=function(t){if(i(()=>{UtilJS.Loading.Hide()},500),t!==undefined&&t.IsOnlyShowAlert){jAlert.Warning("Thao tác không thành công, vui lòng thử lại");return}if(!n.IsShowConfirmRedirectLogin){n.IsShowConfirmRedirectLogin=!0;let r="Phiên đăng nhập hết hạn, vui lòng bấm đồng ý để tải lại trang";t!==undefined&&t.Message&&(r=t.Message);$.confirm({title:"Thông báo!",content:r,buttons:{formSubmit:{text:'<i class="fa fa-check-circle"><\/i> Đồng ý',btnClass:"btn cc-btn-style cc-btn-color-blue",action:function(){UtilJS.Cookie.Remove("returnUrl");UtilJS.Cookie.Create("returnUrl",window.location.href,30);n.IsShowConfirmRedirectLogin=!1;t&&t.status==401?window.location.href="/Accounts/Login":location.reload()}},formSubmit2:{text:"Hủy",btnClass:"btn cc-btn-style",action:function(){n.IsShowConfirmRedirectLogin=!1}}}})}},f};ApiHelper.$inject=["$rootScope","$localstorage","$timeout","$q","$http"];UtilFactory=function(n,t,i){var r={};return r.RoleEnum=Object.freeze({IT:[3147,3193],KT:[3172,3202,3203]}),r.CheckInRole=function(){let t=n.UserPricinpal.RoleIDs,i=_.find(t,n=>r.RoleEnum.IT.includes(n)||r.RoleEnum.KT.includes(n));return i?!0:!1},r.TypeViewEnum=Object.freeze({NganhHang:{Value:1,Text:"Ngành hàng"},SanPham:{Value:2,Text:"Sản phẩm"},KhachHang:{Value:3,Text:"Khách hàng"}}),r.DataTypeView=function(n){let t=[];var i=Object.getOwnPropertyNames(r.TypeViewEnum);return i.forEach(n=>{let i={};i.ID=r.TypeViewEnum[n].Value;i.Name=r.TypeViewEnum[n].Text;t.push(i)}),n&&n.length>0&&(t=t.filter(t=>!n.includes(t.ID))),t},r.RequiredDataTypeView=function(n){var t=angular.element(document.getElementById("ddlUserProductCategory")).scope();n==r.TypeViewEnum.SanPham.Value?(t.myroot.IsShowProduct=!0,t.myroot.ddlUserProductCategory.IsDisableOpenTree=!0,t.myroot.IsShowCustomer=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null):n==r.TypeViewEnum.KhachHang.Value?(t.myroot.IsShowCustomer=!0,t.myroot.ddlUserProductCategory.IsDisableOpenTree=!0,t.myroot.IsShowProduct=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null):(t.myroot.ddlUserProductCategory.IsDisableOpenTree=!1,t.myroot.IsShowProduct=!1,t.myroot.IsShowCustomer=!1,t.myroot.ddlUserProductCategory.API.DeselectAll(),t.myroot.PID=null,t.myroot.ProductID=null,t.myroot.ProductName=null,t.myroot.CustomerID=null,t.myroot.CustomerName=null)},r.PrepareData=function(n,t){let i={};if(i.CategoryIDs=[],i.PID=-2,i.CustomerID=-2,n==r.TypeViewEnum.NganhHang.Value){if(t.CategoryIDs!==undefined&&t.CategoryIDs.length==0)return jAlert.Warning("Vui lòng chọn ngành hàng","Thông báo"),!1;t.hasOwnProperty("PID")&&(t.PID=i.PID);t.hasOwnProperty("ProductID")&&(t.ProductID=i.PID);t.hasOwnProperty("CustomerID")&&(t.CustomerID=i.CustomerID)}if(n==r.TypeViewEnum.SanPham.Value){if(t.PID!==undefined&&!t.PID||t.ProductID!==undefined&&!t.ProductID)return jAlert.Warning("Vui lòng chọn sản phẩm","Thông báo"),!1;t.hasOwnProperty("CategoryIDs")&&(t.CategoryIDs=i.CategoryIDs);t.hasOwnProperty("CustomerID")&&(t.CustomerID=i.CustomerID)}if(n==r.TypeViewEnum.KhachHang.Value){if(t.CustomerID!==undefined&&!t.CustomerID)return jAlert.Warning("Vui lòng chọn khách hàng","Thông báo"),!1;t.hasOwnProperty("CategoryIDs")&&(t.CategoryIDs=i.CategoryIDs);t.hasOwnProperty("PID")&&(t.PID=i.PID);t.hasOwnProperty("ProductID")&&(t.ProductID=i.PID)}return t},r.sortBy=function(){var t=Object.prototype.toString,i=function(n){return n},n=function(n){var t=n!=null&&typeof n=="object",i=t&&this.prop in n;return this.parser(i?n[this.prop]:n)};return function(r,u){return(r instanceof Array&&r.length)?(t.call(u)!=="[object Object]"&&(u={}),typeof u.parser!="function"&&(u.parser=i),u.desc=!u.desc?1:-1,r.sort(function(t,i){return t=n.call(u,t),i=n.call(u,i),u.desc*(t<i?-1:+(t>i))})):[]}}(),r.ParseJsonDate=function(n){return new Date(parseInt(n.replace("/Date(","")))},r.GetDateString=function(n,t){var i=n==undefined?new Date:n,r;return i.setDate(i.getDate()),r=i.toISOString().slice(0,10).replace(/-/g,""),(t=="yyyyMM"||t=="yyyymm")&&(i.setMonth(i.getMonth()-1),r=i.toISOString().slice(0,8).replace(/-/g,"")),r},r.GetDateStringByValue=function(n,t){return n||r.GetDateString(t),t=="yyyyMM"||t=="yyyymm"?n.replace(/(\d\d)\/(\d{4})/,"$2$1"):n.replace(/(\d\d)\/(\d\d)\/(\d{4})/,"$3$2$1")},r.WaittingPopup=function(n,t){return n.rsPopup=undefined,n.defer=null,n.defer||(n.defer=i.defer()),n.defer.myTimer=setInterval(()=>{if(!($(t).data("bs.modal")||{}).isShown&&n.rsPopup!=undefined){clearInterval(n.defer.myTimer);let t=n.rsPopup;n.rsPopup=undefined;n.defer.resolve(t)}},100),n.defer.promise},r.WaitingConditional=function(n,t){return n.defer=null,n.defer||(n.defer=i.defer()),n.defer.myTimer=setInterval(()=>{t()&&(clearInterval(n.defer.myTimer),n.defer.resolve())},100),n.defer.promise},r.WaitingLoadDirective=function(n){clearInterval(r.myTimer);let t=i.defer();return r.myTimer=setInterval(()=>{n.filter(n=>n.IsReady==!0).length==n.length&&(clearInterval(r.myTimer),t.resolve())},100),t.promise},r.InitArrayNoIndex=function(n){for(var i=[],t=1;t<n;t++)i.push(t);return i},r.String={},r.String.IsNullOrEmpty=function(n){return!n||n==null?!0:!1},r.String.IsContain=function(n,t){return r.String.IsNullOrEmpty(n)?!1:r.String.IsNullOrEmpty(t)?!0:n.indexOf(t)<0?!1:!0},r.Alert={},r.Alert.RequestError=function(n){console.log(n);var t="";switch(n.status){case 400:t="Lỗi dữ liệu không hợp lệ";break;case 401:t="Phiên làm việc đã hết hạn, vui lòng đăng nhập lại.";break;case 403:t="Bạn không có quyền thực hiện thao tác này.";break;case 404:t="URL action không chính xác";break;case 405:t="Phương thức không được chấp nhận";break;case 500:t="Lỗi hệ thống";break;case 502:t="Đường truyền kém";break;case 503:t="Dịch vụ không hợp lệ";break;case 504:t="Hết thời gian chờ";break;case 440:t="Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại";break;default:t="Lỗi chưa xác định"}jAlert.Error(t,"Thông báo")},r};UtilFactory.$inject=["$rootScope","$timeout","$q"];HelperFactory=function(n,t,i){var r={};return r.User={},r.User.GetAccessToken=function(){return r.User.AccessToken||(UtilJS.Loading.Show(),i.PostDataAjaxAsync("/Home/GetAccesToken",null,function(){},function(n){if(UtilJS.Loading.Hide(),n.objCodeStep.Status=="Error"){console.log(n);throw n.objCodeStep.Message;}n.objCodeStep.Status=="Success"&&(r.User.AccessToken=n.strAccesToken)},function(n){UtilJS.Loading.Hide();console.log(n);throw"error";})),r.User.AccessToken},r};HelperFactory.$inject=["$rootScope","$timeout","CommonFactory"];DataFactory=function(n,t,i,r,u,f,e,o){var s={};return s.DepartmentTree_Read=function(){let n=u.defer();return s.Department_Get().then(function(t){let i={};i.Data=_.map(t.Data,_.clone);i.Data.forEach(n=>{n.id=n.DepartmentID,n.text=n.DepartmentName,n.parent=n.ParentID,n.ParentID==0&&(n.parent="#"),n.id==n.parent&&console.log("lỗi: id = parent",n)});n.resolve(i)}).catch(function(t){n.reject(t)}),n.promise},s.Department_Get=function(){let n=ApiEndPoint.DepartmentResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Department})},s.Suppliers_Get=function(){let n=ApiEndPoint.SupplierResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Supplier})},s.CustomerMemberTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.CustomerMemberType})},s.StoreTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.StoreType})},s.IvenCenterStockTypes_Get=function(){let n=ApiEndPoint.IvenCenterStockTypesResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.IvenCenterStockType})},s.PaymentTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PaymentType})},s.VoucherTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherType})},s.VoucherGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherGroup})},s.Stores_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.Store})},s.InvoiceStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InvoiceStatus})},s.PayFormStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PayFormStatus})},s.PayFormTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PayFormType})},s.VoucherBanks_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.VoucherBank})},s.OutputTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.OutputType})},s.OutputTypes_ByUserLogin=function(){let n=u.defer();return o.PostMethod("/OutputTypes/GetByUser/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>(t.Data=[],n.resolve(t))),n.promise},s.OutputGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.OutputGroup})},s.UserStores_Get=function(){let n=u.defer();return o.PostMethod("/Users/GetStore/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>n.reject(t)),n.promise},s.Users_Get=()=>{let n=u.defer();return o.PostMethod("/Users/List/").then(function(t){return t.objCodeStep.Status==="Warning"&&n.reject(t),n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},s.PurcOrderStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PurcOrderStatus})},s.InputGroups_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InputGroup})},s.InputTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.InputType})},s.SalaryShifts_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.SalaryShift})},s.PromotionTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.PromotionType})},s.StoreChangeTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.StoreChangeType})},s.TransportTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.TransportType})},s.Shelfs_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.Shelf})},s.StoreGroup_Get=function(n){let i=n.filter(n=>n.ParentStoreGroupID===0&&n.StoreID===0),t=[];n.filter(n=>{_.find(t,t=>t.StoreGroupID===n.StoreGroupID&&t.ParentStoreGroupID===n.ParentStoreGroupID)||t.push({StoreGroupID:n.StoreGroupID,StoreGroupName:n.StoreGroupName,ParentStoreGroupID:n.ParentStoreGroupID})});return i.filter(n=>{t.push({StoreGroupID:n.StoreGroupID,StoreGroupName:n.StoreGroupName,ParentStoreGroupID:n.ParentStoreGroupID,DeliveryDayNumber:n.DeliveryDayNumber,IsActived:n.IsActived})}),t},s.StoreGroup_ReadAll=function(){let n=u.defer();return o.PostMethod("/StoreGroups/List/").then(function(t){return t.objCodeStep.Status==="Warning"&&n.reject(t),n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},s.StoreGroupTree_Read=function(){let n=u.defer();return s.StoreGroup_ReadAll().then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)}),n.promise},s.StoreSizes_Get=function(){let n=ApiEndPoint.StoreSizeResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.StoreSize})},s.Wards_Get=function(){let n=ApiEndPoint.WardResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Ward})},s.Provinces_Get=function(){let n=ApiEndPoint.ProvinceResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Province})},s.Districts_Get=function(){let n=ApiEndPoint.DistrictResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.District})},s.Areas_Get=function(){let n=ApiEndPoint.AreasResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.Areas})},s.PriceRegions_Get=function(){let n=ApiEndPoint.PriceRegionResource;return e.GetMethod(n,{},{CacheKeyClient:CacheKeyClient.PriceRegions})},s.ProductCategoriesTree_Read=function(n){let t=u.defer();return n?(s.ProductCategories_Get().then(n=>{let i=n.Data;return i.forEach(n=>{n.id=n.CategoryID,n.text=n.CategoryName,n.parent=n.ParentCategoryID==0?"#":n.ParentCategoryID}),t.resolve(n)}).catch(n=>{UtilJS.Loading.Hide();throw n;}),t.promise):(u.all({res1:s.ProductCategories_Get(),res2:s.ProductCategories_ByUserLogin()}).then(n=>{let i=n.res1.Data,u=n.res2.Data;i.forEach(n=>{n.id=n.CategoryID,n.text=n.CategoryName,n.parent=n.ParentCategoryID==0?"#":n.ParentCategoryID,n.IsHide=!0});var r=[];u.filter(n=>r.push(n.CategoryID));i.forEach(n=>{_.contains(r,n.id)&&(n.IsHide=!1,s.GetParentsByID(i,n.parent))});let f=i.filter(n=>!n.IsHide);return n.res2.Data=f,t.resolve(n.res2)}).catch(n=>{UtilJS.Loading.Hide();throw n;}),t.promise)},s.GetParentsByID=function(n,t){if(t!="#"){var i=_.find(n,n=>n.id===t);i&&i.IsHide&&(i.IsHide=!1,s.GetParentsByID(n,i.parent))}},s.ProductCategories_Get=()=>e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.ProductCategories}),s.ProductCategories_ByUserLogin=function(){let n=u.defer();return o.PostMethod("/Users/GetProductCategories/").then(t=>t.StatusCode==204?(t.Is204=!0,t.Data=[],n.resolve(t)):n.resolve(t)).catch(t=>n.reject(t)),n.promise},s.StoreTree_Read=n=>{let t=u.defer(),i=n=>{var r=[],u=_.groupBy(n,"AreaID"),i,t;for(i in u)t={},t.id="G_"+i,t.text=u[i][0].AreaName,t.parent="#",t.IsSaleStore=!0,t.ProvinceIDs=[],t.DistrictIDs=[],u[i].forEach(n=>{var i=n;i.id=n.StoreID;i.text=n.StoreName;i.parent="G_"+n.AreaID.toString();i.ProvinceID=n.ProvinceID;i.DistrictID=n.DistrictID;i.ProvinceIDs=[];i.DistrictIDs=[];r.push(i);t.ProvinceIDs.push(n.ProvinceID);t.DistrictIDs.push(n.DistrictID)}),r.push(t);return r};return n?(s.Stores_Get().then(n=>{n.Data=i(n.Data.filter(n=>n.IsActived)),t.resolve(n)}).catch(n=>{t.reject(n)}),t.promise):(s.UserStores_Get().then(n=>{n.Data=i(n.Data),t.resolve(n)}).catch(n=>{t.reject(n)}),t.promise)},s.DeliveryFees_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.DeliveryFee})},s.DeliveryTypes_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.DeliveryType})},s.Companies_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.Company})},s.ShippingStatus_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.ShippingStatus})},s.OutputFastSource_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.OutputFastSource})},s.ProvinceMappingGoogle_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.ProvinceMappingGoogle})},s.DistrictMappingGoogle_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.DistrictMappingGoogle})},s.WardMappingGoogle_Get=function(){return e.GetMethod("",{},{CacheKeyClient:CacheKeyClient.WardMappingGoogle})},s};DataFactory.$inject=["$rootScope","$localstorage","$timeout","UtilFactory","$q","$http","ApiHelper","CommonFactory"];dateFormat=function(n){return function(t,i){var u,f,r;return t?((i==undefined||i=="")&&(i="dd/MM/yyyy"),t instanceof Date?r=t:(u=t.replace(/\//g,"").replace("(","").replace(")","").replace("Date","").replace("+0700","").replace("-0000",""),r=t.indexOf("Date")>-1?new Date(+u):new Date(u),f=r.getTime()+r.getTimezoneOffset()*6e4,r=new Date(f+252e5)),n("date")(r,i)):""}};dateFormat.$inject=["$filter"];trustHtml=function(n){return function(t){return t?n.trustAsHtml(t):""}};trustHtml.$inject=["$sce"];ifEmpty=function(){return function(n,t){return angular.isUndefined(n)||n===null||n===""||n==="Invalid date"?t:n}};toFixedDecimal=function(n){try{return function(t,i){var r,u;if(!t)return 0;if(r=t.toString().split(".")[1],r){if(i==undefined||i==="")i=r.length;else{for(r=r.toString().slice(0,i),u=r.length;u>0;u--)if(r.charAt(u-1)!=0)break;else r=r.substring(0,r.length-1);i=r.length}t=n("number")(parseFloat(t),i)}else t=n("number")(t);return t}}catch(t){return 0}};toFixedDecimal.$inject=["$filter"];lstDependency=[];lstDependency.push("ngRoute");lstDependency.push("ngTagsInput");MyApp=angular.module("MyApp",lstDependency);addFactory=function(n,t){try{MyApp.factory(n,t)}catch(i){console.log(JSON.stringify(i))}};addFactory("$localstorage",$localstorage);addFactory("CommonFactory",CommonFactory);addFactory("UtilFactory",UtilFactory);addFactory("HelperFactory",HelperFactory);addFactory("ApiHelper",ApiHelper);addFactory("DataFactory",DataFactory);addController=function(n,t){try{MyApp.controller(n,t)}catch(i){console.log(JSON.stringify(i))}};addController("MasterPageController",MasterPageController);addDirective=function(n,t){try{MyApp.directive(n,t)}catch(i){console.log(JSON.stringify(i))}};addDirective("fileAttachUpload",fileAttachUpload);addDirective("lazyLoadMore",lazyLoadMore);addDirective("customSelect2",customSelect2);addDirective("dateTimePicker",dateTimePicker);addDirective("formatMoney",formatMoney);addDirective("getWidth",getWidth);addDirective("getHeight",getHeight);addDirective("lazyLoad",lazyLoad);addDirective("noInput",noInput);addDirective("whenEnter",whenEnter);addDirective("compile",compile);addDirective("inputFormat",inputFormat);addDirective("paginationStyle1",paginationStyle1);addDirective("paginationStyle2",paginationStyle2);addFilter=function(n,t){try{MyApp.filter(n,t)}catch(i){console.log(JSON.stringify(i))}};addFilter("dateFormat",dateFormat);addFilter("trustHtml",trustHtml);addFilter("ifEmpty",ifEmpty);addFilter("toFixedDecimal",toFixedDecimal);MyAppSetConfig={};MyAppSetConfig.addURL=function(n,t,i,r){try{r.when("/"+n,{templateUrl:"/"+t,controller:i})}catch(u){console.log(u)}};MyAppSetConfig.Otherwise=function(n,t){t.otherwise({redirectTo:"/"+n})};addFactory("$exceptionHandler",function(){return function(n){setTimeout(function(){throw n;},1e3)}});