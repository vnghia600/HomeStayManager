var fileAttachUpload=function(n,t,i,r,u,f){return{restrict:"E",transclude:!0,scope:{myroot:"="},templateUrl:"/script-handler/app/directives/file-attach-upload/file-attach-upload.html",link:function(n,i){function r(){this.IsDeleted=!1;this.Base64="";this.Src="";this.DataType="";this.Http=new XMLHttpRequest;this.FileInput={};this.Percent=0;this.FileName=""}n.myroot||(n.myroot={});n.myroot.Core||(n.myroot.Core={});n.myroot.Core.IsListenProgress||(n.myroot.Core.IsListenProgress=!0);n.myroot.Core.Accept||(n.myroot.Core.Accept="*");n.myroot.Core.IsMultipleFile||(n.myroot.Core.IsMultipleFile=!1);n.myroot.IsListenProgress=n.myroot.Core.IsListenProgress;n.myroot.IsMultipleFile=n.myroot.Core.IsMultipleFile;n.myroot.LstFile=[];n.btnOpenDialog=i[0].querySelector(".btnOpenDialog");n.input=i[0].querySelector(".files");n.btnOpenDialog&&n.btnOpenDialog.addEventListener("click",function(){t(()=>{angular.element(n.input).trigger("click")})});n.input.addEventListener("change",function(i){if(!f.CheckToken()){UtilJS.Loading.Hide();return}t(()=>{var f=i.target.files,c,o,t,h;if(f.length!=0){c=f[0].size;let s=2;if(MasterData.MaxSizeUpload&&(s=MasterData.MaxSizeUpload),c>s*1048576){jAlert.Warning("Đính kèm không vượt quá "+s+" MB.");return}if(!n.myroot.IsMultipleFile&&(n.myroot.LstFile=[],f.length>1)){jAlert.Warning("Vui lòng up 1 file");return}if(UtilJS.String.IsContain(f[0].name,",")){jAlert.Warning('Tên file không hợp lệ. Vui lòng xóa dấu "," và thử lại');return}for(o=0;o<f.length;o++)t=new r,t.FileInput=f[o],t.FileName=f[o].name.normalize(),n.myroot.IsListenProgress&&(t.AlertNotFoundTimeout=!1,u(t),e(t)),n.myroot.LstFile.push(t),n.myroot.IsMultipleFile||(UtilJS.Loading.Show(),n.myroot.CallBack.UploadBegin&&n.myroot.CallBack.UploadBegin(t),t.Http.open("POST","/Directives/UploadFileToGCS/",!0),h=new FormData,h.append("file",t.FileInput),n.myroot.SubModuleName&&t.Http.setRequestHeader("subModuleName",n.myroot.SubModuleName),t.Http.send(h))}}).then(()=>{angular.element(n.input).val(null)})});n.myroot.API={};n.myroot.API.ClearLstItem=()=>{n.myroot.LstFile=[]};n.myroot.API.ResetItem=function(n){n.Percent=0;n.FileName="";n.FilePathSaved=""};n.myroot.CallBack||(n.myroot.CallBack={});var u=function(n){n.Http.upload.addEventListener("progress",function(i){t(()=>{fileLoaded=i.loaded,fileTotal=i.total,fileProgress=parseInt(fileLoaded/fileTotal*100)||0,n.Percent=fileProgress},50)},!1)},e=function(i){i.Http.onreadystatechange=function(){i.Http.readyState==4&&i.Http.status==200?t(()=>{var t=JSON.parse(i.Http.responseText);UtilJS.Loading.Hide();i.Percent=100;let r=t.Data;Object.assign(i,r);i.IsSuccess=!0;n.myroot.CallBack.UploadDone&&n.myroot.CallBack.UploadDone(i);return},200):i.Http.readyState==4&&i.Http.status!=200&&(t.cancel(i.AlertNotFoundTimeout),i.AlertNotFoundTimeout=t(()=>{i.Http.status==404?jAlert.Error("Định dạng file không đúng.","Thông báo"):i.Http.status==401?jAlert.Warning("Phiên làm việc đã hết hạn, vui lòng đăng nhập lại."):i.Http.status==0?jAlert.Warning("Server không phản hồi"):(jAlert.Error("Lỗi status "+i.Http.status,"Thông báo"),console.log(i.Http));i.Percent=0;i.FileName="";UtilJS.Loading.Hide();i.IsSuccess=!1;n.myroot.CallBack.UploadDone&&n.myroot.CallBack.UploadDone(i);return},200));n.$apply()}};n.myroot.OpenBrowse=()=>{n.myroot.Core.IsOpenBrowse()&&t(()=>{n.input.click()})};n.myroot.IsReady=!0}}},lazyLoadMore,customSelect2,dateTimePicker,formatMoney,getWidth,getHeight,lazyLoad,noInput,whenEnter,compile,paginationStyle1,paginationStyle2,inputFormat;fileAttachUpload.$inject=["$q","$timeout","CommonFactory","$localstorage","$rootScope","ApiHelper"];lazyLoadMore=function(){return{restrict:"A",link:function(n,t){var i=t[0];$(i).bind("scroll",function(){i.scrollTop+i.offsetHeight>=i.scrollHeight&&n.$apply("LoadMore()")})}}};lazyLoadMore.$inject=[];customSelect2=function(n,t){return{restrict:"E",scope:{myroot:"="},templateUrl:"/script-handler/app/directives/custom-select2/custom-select2.html",link:function(i,r,u){if(i.myroot.UpdateValueSelected=function(t){clearInterval(i.myroot.myTimer);let u=n.defer();return i.myroot.myTimer=setInterval(()=>{i.myroot.IsFinishRender&&(i.myroot.IsDebug,t!==undefined&&(i.myroot.Value=t),clearInterval(i.myroot.myTimer),i.SetValid(i.myroot.Value),i.myControl.val(i.myroot.Value),i.myControl_s2id=$(r[0]).find(".select2-container"),i.myControl_s2id.select2("val",i.myroot.Value),u.resolve(i.myroot.Value))},100),u.promise},i.SetValid=function(n,t){n===""?$("input[name="+i.myroot.ID+"]").val(""):$("input[name="+i.myroot.ID+"]").val(n);try{t&&$("input[name="+i.myroot.ID+"]").valid()}catch(r){}},i.myControl=$(r[0]).find(".myControl"),i.myroot.IsDebug,i.myroot.Core.Label?i.myroot.Core.label2=i.myroot.Core.Label:i.myroot.Core.label=u.label,i.myroot.Core.label2||(i.myroot.Core.label2="Chọn "+u.label.charAt(0).toLowerCase()+u.label.slice(1)),i.myroot.ID=u.myroot.replace(".","_"),i.myroot.IsFinishRender=!i.myroot.Lst||i.myroot.Lst&&i.myroot.Lst.length==0,i.myroot.API||(i.myroot.API={}),i.myroot.CallBack||(i.myroot.CallBack={}),i.myroot.Core.ValueDefault||(i.myroot.Core.ValueDefault=""),i.myroot.ValueOrginal="",i.myroot.Value?(i.myroot.ValueOrginal=i.myroot.Value,i.myroot.Value=i.myroot.Value.toString()):i.myroot.Value=i.myroot.Core.ValueDefault,i.myroot.Onchange=function(){t.isCustomSelect2Enable||(i.myroot.IsDebug,i.SetValid(i.myroot.Value,!0),i.myroot.CallBack.OnValuechanged&&i.myroot.CallBack.OnValuechanged(i.myroot.Value),i.myroot.CallBack.Onchanged&&i.myroot.CallBack.Onchanged())},i.myroot.API.DiscardChange=function(){i.myroot.API.SetValue(i.myroot.ValueOrginal,!0)},i.myroot.API.SetValue=function(n,t){try{i.myroot.IsDebug;(n===null||n===undefined)&&(n=i.myroot.Core.ValueDefault);i.myroot.ValueOrginal=n;i.myroot.Value=n.toString();i.myroot.UpdateValueSelected().then(n=>{i.myroot.IsDebug,t||i.myroot.CallBack.OnValuechanged&&i.myroot.CallBack.OnValuechanged(n)})}catch(r){throw r;}},i.myroot.API.DataSource=function(n,t){i.myroot.IsDebug;i.myroot.Lst=n;i.myroot.UpdateValueSelected(t)},i.myroot.API.OnStart=function(){i.myroot.IsDebug;i.myroot.IsFinishRender=!1},i.myroot.API.OnEnd=function(){i.myroot.IsDebug;i.myroot.IsFinishRender=!0},t.beginBlockAllSelect2=function(){t.isCustomSelect2Enable=!0},t.endBlockAllSelect2=function(){t.isCustomSelect2Enable=!1},i.myroot.UpdateValueSelected(),i.myControl.select2(),i.myroot.CallBack&&i.myroot.CallBack.OnOpenSelect2)$(r[0]).on("select2-open",function(){i.myroot.CallBack.OnOpenSelect2()});i.myroot.IsReady=!0}}};customSelect2.$inject=["$q","$rootScope"];dateTimePicker=function(){return{restrict:"E",scope:{myroot:"="},templateUrl:"/script-handler/app/directives/date-time-picker/date-time-picker.html",link:function(n,t,i){n.input=$(t[0]).find(".myDtm");n.myroot.API||(n.myroot.API={});n.myroot.CallBack||(n.myroot.CallBack={});n.myroot.ID=i.myroot.replace(".","_");n.myroot.Core.showTodayButton=!0;n.myroot.Core.showClear=!0;n.myroot.Core.showClose=!0;n.myroot.Core.label=i.label;n.myroot.Core.DateType=="DateTime"?(n.myroot.Core.FormatValueDisplay||(n.myroot.Core.format="DD/MM/YYYY HH:mm"),n.myroot.Core.FormatValue||(n.myroot.Core.FormatValue="MM/DD/YYYY HH:mm")):(n.myroot.Core.FormatValueDisplay||(n.myroot.Core.format="DD/MM/YYYY"),n.myroot.Core.FormatValue||(n.myroot.Core.FormatValue="MM/DD/YYYY"));n.myroot.ValueOrginal=undefined;n.myroot.Value?(n.myroot.ValueOrginal=n.myroot.Value,n.myroot.ValueDisplay=moment(n.myroot.Value).format(n.myroot.Core.format),n.myroot.Value=moment(n.myroot.Value).format(n.myroot.Core.FormatValue)):n.myroot.Value=null;n.myroot.API.SetValue=function(t,i){try{n.myroot.IsDebug;n.myroot.ValueOrginal=t;t===null||t===undefined?(n.myroot.ValueDisplay=null,n.myroot.Value=null):(n.myroot.ValueDisplay=moment(t).format(n.myroot.Core.format),n.myroot.Value=moment(t).format(n.myroot.Core.FormatValue));$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);!i&&n.myroot.CallBack.OnValuechanged&&n.myroot.CallBack.OnValuechanged(n.myroot.Value)}catch(r){throw r;}};n.myroot.config={};n.myroot.config.format=n.myroot.Core.format;n.myroot.config.showTodayButton=!0;n.myroot.config.showClear=!0;n.myroot.config.showClose=!0;n.myroot.config.minDate=n.myroot.Core.MinDate?n.myroot.Core.MinDate:new Date(0);n.myroot.Core.UseCurrent!=undefined&&(n.myroot.config.useCurrent=n.myroot.Core.UseCurrent);n.input.datetimepicker(n.myroot.config);n.input.on("dp.change",function(t){n.myroot.IsDebug;t.date?(n.myroot.ValueDisplay=n.input.val(),n.myroot.Value=moment(t.date).format(n.myroot.Core.FormatValue)):(n.myroot.ValueDisplay=null,n.myroot.Value=null);$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);try{$("input[name="+n.myroot.ID+"]").valid()}catch(t){}n.myroot.CallBack.OnValuechanged&&n.myroot.CallBack.OnValuechanged(n.myroot.Value)});n.myroot.API.SetMinDate=function(t){n.myroot.IsDebug;moment(t).isValid()&&(t=moment(t)._d,n.input.data("DateTimePicker").minDate(t))};n.myroot.API.SetMinTime=function(t){if(n.myroot.IsDebug,moment(t).isValid()){let i=moment(t).format("HH:mm");n.input.setOptions({minTime:i})}};n.myroot.API.SetMaxDate=function(t){n.myroot.IsDebug;moment(t).isValid()&&(t=moment(t)._d,n.input.data("DateTimePicker").maxDate(t))};$("input[name="+n.myroot.ID+"]").val(n.myroot.Value);n.myroot.IsReady=!0}}};dateTimePicker.$inject=[];formatMoney=function(n,t){return{require:"?ngModel",restrict:"A",scope:{myModel:"=",precision:"=",formatMoneyNoInput:"="},link:function(n,i){(n.precision==null||n.precision==undefined)&&(n.precision=0);i.maskMoney({allowNegative:!0,thousands:",",decimal:".",affixesStay:!1,allowZero:!0,precision:n.precision});i.keydown(function(r){var u=String.fromCharCode(r.which);if(_.contains(n.formatMoneyNoInput,u)){r.preventDefault();return}t(function(){n.myModel=parseFloat(i.val().replace(new RegExp(",","g"),""));i.trigger("change")})});n.$watch("myModel",function(){$.isNumeric(n.myModel)&&n.myModel.toString().indexOf(".")>0?i.val(n.myModel.toFixed(n.precision)).trigger("mask.maskMoney"):i.val(n.myModel).trigger("mask.maskMoney")})}}};formatMoney.$inject=["$filter","$timeout"];getWidth=function(n,t){return{restrict:"A",scope:{getWidth:"="},link:function(n,i){$(function(){n.getWidth=i[0].offsetWidth;t(function(){n.getWidth=i[0].offsetWidth},500)})}}};getWidth.$inject=["$timeout","$interval"];getHeight=function(n,t){return{restrict:"A",scope:{getHeight:"="},link:function(n,i){$(function(){n.getHeight=i[0].offsetHeight;t(function(){n.getHeight=i[0].offsetHeight},500)})}}};getHeight.$inject=["$timeout","$interval"];lazyLoad=function(n,t){return{restrict:"A",scope:{fncallback:"&lazyLoad"},link:function(n,i){n.IsLoaded=!1;n.raw=i[0];angular.element(t).bind("scroll",function(){var i=$(n.raw).is(":visible"),t;!n.IsLoaded&&i&&(t=$(n.raw).position().top,this.pageYOffset+this.innerHeight>=t&&(n.fncallback(),n.IsLoaded=!0,n.$apply()))})}}};lazyLoad.$inject=["$timeout","$window"];noInput=function(){return{restrict:"A",scope:{noInput:"="},link:function(n,t){t.bind("keydown keypress",function(t){var i=String.fromCharCode(t.which);_.contains(n.noInput,i)&&t.preventDefault()})}}};noInput.$inject=[];whenEnter=function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.whenEnter)}),t.preventDefault())})}};whenEnter.$inject=[];compile=function(n){return function(t,i,r){t.$watch(function(n){return n.$eval(r.compile)},function(r){i.html(r);n(i.contents())(t)})}};compile.$inject=["$compile"];paginationStyle1=function(n){return{restrict:"E",scope:{pager:"=",totalItems:"=",fnCallBack:"&"},templateUrl:"/script-handler/app/directives/pagination-style/pagination-style.html",link:function(t){function i(){if(!t.pager.CurrentPage||t.pager.CurrentPage<1||t.pager.CurrentPage>t.pager.TotalPages){t.pager.Pages=[];return}if(!t.pager.TotalPages){t.pager.Pages=[];return}r(t.pager.TotalItems,t.pager.CurrentPage,t.pager.PageSize)}function r(n,i,r){var o,e,c,v,l,u;i=i||1;r=r||10;o=t.pager.StartPage||1;e=t.pager.EndPage||10;var s=10,f=[],h=Math.floor(t.pager.TotalPages/s),a=t.pager.TotalPages%s;for(u=1;u<=h;u++)c=(u-1)*r,v=c+s,f.push({Start:c+1,End:v});for(a>0&&f.push({Start:h*s+1,End:h*s+a}),l=!1,u=0;u<f.length;u++)if(i>=f[u].Start&&i<=f[u].End){o=f[u].Start;e=f[u].End;e>10&&e-o<9&&(o=e-9);l=!0;break}l||(i=f[0].Start,o=f[0].Start,e=f[0].End);var y=(i-1)*r,w=Math.min(y+r-1,n-1),p=[];for(u=o;u<=e;u++)p.push(u);i<=0&&(i=1);t.pager.PageSize=r;t.pager.StartPage=o;t.pager.EndPage=e;t.pager.StartIndex=y;t.pager.EndIndex=w;t.pager.Pages=p}t.pager.TotalItems=0;t.pager.TotalPages=0;t.$watch("totalItems",function(){t.pager.TotalItems=t.totalItems;t.InitPager()});t.$watch("pager.CurrentPage",function(){t.InitPager()});t.InitPager=function(){n(function(){t.pager.TotalPages=Math.ceil(t.pager.TotalItems/t.pager.PageSize);t.pager.CurrentPage>t.pager.TotalPages&&(t.pager.CurrentPage=t.pager.TotalPages,t.pager.TotalPages==0&&(t.pager.CurrentPage=1));i()})};t.Exec=function(n){n>t.pager.TotalPages||t.fnCallBack({PageClicked:n})};t.ExecFirst=function(n){n>t.pager.TotalPages&&(n=t.pager.TotalPages);n<=0&&(n=1);t.pager.StartPage=t.pager.StartPage-10;t.pager.EndPage=t.pager.EndPage-10;t.pager.StartPage<=0&&(t.pager.StartPage=1,t.pager.EndPage=10);t.fnCallBack({PageClicked:n})};t.ExecLast=function(n){n>t.pager.TotalPages&&(n=t.pager.TotalPages);t.pager.StartPage=t.pager.EndPage+1;t.pager.EndPage=t.pager.StartPage+9;t.pager.EndPage>t.pager.TotalPages&&(t.pager.EndPage=t.pager.TotalPages,t.pager.StartPage=t.pager.EndPage-9);t.fnCallBack({PageClicked:n})};t.pager.GetPageIndexReLoad=function(n){return t.pager.CurrentPage<t.pager.TotalPages?t.pager.CurrentPage:n%t.pager.PageSize>0?t.pager.CurrentPage:t.pager.CurrentPage-1}}}};paginationStyle1.$inject=["$timeout"];paginationStyle2=function(n){return{restrict:"E",scope:{pager:"=",totalItems:"=",fnCallBack:"&"},templateUrl:"/script-handler/app/directives/pagination-style2/pagination-style2.html",link:function(t){t.pager.MaxPage=-1;t.$watch("totalItems",function(){t.pager.TotalItems=t.totalItems;t.pager.MaxPage=-1;t.InitPager()});t.$watch("pager.CurrentPage",function(){t.InitPager()});t.InitPager=function(){n(function(){var n=(t.pager.CurrentPage-1)*t.pager.PageSize,i=n+t.pager.PageSize;t.pager.StartIndex=n;i>=t.pager.TotalItems&&(t.pager.MaxPage=t.pager.CurrentPage)})};t.Exec=function(n){t.pager.MaxPage>-1&&n>t.pager.MaxPage||n<=0||t.fnCallBack({PageClicked:n})}}}};paginationStyle2.$inject=["$timeout"];inputFormat=function(n){return{require:"?ngModel",restrict:"A",link:function(t,i,r,u){function f(u,f){var o="",e="";if(u===""||u===null||u===undefined)return 0;if(o=u.toString(),e=o.replace(/,/g,"").replace(/[A-Za-z]/g,""),e=parseFloat(e),e=isNaN(e)?"":e.toString(),e=o.length===1&&o[0]==="-"?o[0]:o.length===1&&o[0]==="0"?"0":t.allowdecimal?n(r.inputFormat)(e?e:0,8):n(r.inputFormat)(e?e:0),r.integer||(e.indexOf(".")===-1?o.slice(-1)==="."?e+=".":o.slice(-2)===".0"?e+=".0":o.slice(-3)===".00"?e+=".00":o.slice(-4)===".000"?e+=".000":o.slice(-5)===".0000"?e+=".0000":o.slice(-6)===".00000"?e+=".00000":o.slice(-7)===".000000"?e+=".000000":o.slice(-8)===".0000000"&&(e+=".0000000"):o.slice(-1)==="0"&&(e=o)),r.positive&&e[0]==="-"&&(e=e.substring(1)),typeof f!="undefined")return e===""?0:e;i.val(e==="0"?"0":e).trigger("change")}function e(n){var t=n.toString().replace(/,/g,"").replace(/[A-Za-z]/g,"");return t=parseFloat(t),t=isNaN(t)?0:t,r.positive&&(t=Math.abs(t)),t}u!=null&&(u.$formatters.push(function(n){return f(n,!0)}),u.$parsers.push(function(n){return f(n),e(n)}),i.bind("keypress",function(n){var u=n.which||n.keyCode,e=r.allowDecimal=="true"?!0:!1;t.allowdecimal=e;u>47&&u<58||u==8||u==9||u==190||u==39||u==37||u==43||e&&u==46?f(i.val()):n.preventDefault()}))}}};inputFormat.$inject=["$filter"];